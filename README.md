# 2025QC-Reservoir
リザバーコンピューティングの有効性評価のための検証支援業務

## 概要
国立研究開発法人新エネルギー・産業技術総合開発機構（NEDO）の「リザバーコンピューティング技術の有効性検証に関する技術調査事業」において、現場データを取得し有効性を評価するためのデータ作成と弊社が提供するライブラリを活用した分析の試行的実施を行う。

## 業務内容
リザバーコンピューティングの家庭用サービスロボット分野での活用の方法を検討し、検証用データの作成と弊社が提供するライブラリを活用した技術の有効性の評価を行う。

具体的には、以下の作業を行う。
- リザバーを用いた移動人物の経路予測プログラムの作成
- 家庭環境での従来手法との比較調査
- ＱｕａｎｔｕｍＣｏｒｅ社開発のライブラリの統合検討

## 成果物
- 検証結果報告書
- 検証用データ
- 検証用プログラム及びマニュアル　一式

## TID -> QC
[ROS 2 Leg Finder + Path Prediction (Dockerized)](https://gitlab.com/tidbots/path_prediction)

```
git clone --recursive git@github.com:tidbots/2025QC-Reservoir.git
```

## 評価経過

### ETHデータセットによる予測精度検証

ETH歩行者追跡データセット（ETH Zurich公開）を使用してESN経路予測の精度を評価。

#### 手法比較結果

| 手法 | 平均誤差 (m) | 備考 |
|------|-------------|------|
| **Kalman単体** | **0.509** | 直線軌道に最適 |
| Linear | 0.684 | 線形外挿 |
| V3 (Adaptive ESN) | 0.623 | 軌跡複雑度に応じた動的重み調整 |
| V2 (ESN+Kalman) | 0.753 | 固定重みハイブリッド |
| V1 (ESN only) | 0.901 | ESNアンサンブル |
| f(x) avg | 3.443 | RSJ2025 1I5-03の手法（不安定） |

#### バージョン間比較

| Version | 平均誤差 | vs V1 | vs V2 |
|---------|---------|-------|-------|
| V1 (ESN only) | 0.901m | - | - |
| V2 (Kalman Hybrid) | 0.753m | +16.4% | - |
| V3 (Adaptive) | 0.623m | +30.8% | +17.2% |

#### 複雑軌跡 vs 直線軌跡 比較

軌跡複雑度スコアにより歩行者を選別して比較：

| 手法 | 複雑軌跡 (m) | 直線軌跡 (m) |
|------|-------------|-------------|
| **Kalman** | **1.075** | **1.107** |
| V3 (Adaptive) | 1.523 | 1.188 |
| V2 (ESN+Kalman) | 1.903 | 1.309 |
| V1 (ESN) | 2.375 | 1.477 |

- 複雑軌跡: ped_ids 68, 90, 165, 399, 116（最大角度150°以上）
- 直線軌跡: ped_ids 280, 248, 249, 273, 87（最大角度30°未満）

#### 方向転換区間のみの評価（重要な発見）

ETHデータセットから方向転換フレーム（角度変化>20°）のみを抽出して評価。

| 区間 | Kalman | V3 | Best |
|------|--------|-----|------|
| **方向転換時** | 3.107 | **2.924** | **V3** |
| 非方向転換時 | **2.555** | 2.938 | **Kalman** |

#### パラメータチューニング

| パラメータ | 最適化前 | 最適化後 |
|-----------|---------|---------|
| units | 25 | **50** |
| spectral_radius | 0.8-0.9 | **0.90-0.98** |
| leaking_rate | 0.35-0.6 | **0.50-0.70** |
| input_scaling | 0.2-0.4 | **0.40-0.60** |

#### 予測ホライズン比較

| Horizon | Kalman | V3 (Hybrid) | 差 |
|---------|--------|-------------|-----|
| 20 | **1.93m** | 2.21m | -15% |
| 30 | **2.89m** | 3.34m | -16% |
| 40 | **3.91m** | 4.48m | -15% |
| 50 | **4.95m** | 5.70m | -15% |

#### ETH全データ評価（136人）

| 手法 | 平均誤差 (m) |
|------|-------------|
| **Kalman** | **1.184m** |
| V3 (Adaptive) | 1.316m |
| V2 (Fixed) | 1.504m |
| V1 (ESN) | 1.753m |

#### 最終結論

1. **ETHデータセットではKalmanが最良** - 歩行者の動きは本質的に線形
2. **V3はV1比24.9%改善** - ESNの適応学習とKalmanの安定性を組み合わせ
3. **ESNの限界** - 線形な動きに対しては過剰な複雑さ、ホライズン延長でも改善せず

#### ESNが有効になる可能性

- より非線形な動き（ロボット制御など）
- 繰り返しパターンを含むデータ
- 長期的な依存関係がある時系列

### 評価ツール

```bash
# V1 vs V2 比較
python3 tools/eth_v1_v2_comparison.py --ped_ids 399 168 269 177 178

# V3 適応型ESN評価
python3 tools/eth_v3_adaptive.py --ped_ids 399 168 269 177 178

# 従来手法との比較
python3 tools/eth_method_comparison.py --ped_ids 399 168 269 177 178
```

## ドキュメント

詳細は [docs/](docs/) を参照してください。

- [path_prediction概要](docs/path_prediction.md) - システム概要
- [leg_finder詳細](docs/path_prediction_leg_finder.md) - 脚検出アルゴリズム
- [ESN経路予測詳細](docs/path_prediction_esn.md) - ESNアルゴリズム
- [デプロイメント](docs/path_prediction_deployment.md) - Docker設定
- [検証ツール](docs/path_prediction_tools.md) - ETHデータセット評価スクリプト
- [ETHデータセット評価](docs/path_prediction_eth_evaluation.md) - 予測精度の検証結果（V1/V2/V3比較含む）
- [V2改良検証](docs/path_prediction_v2_improvements.md) - カルマンハイブリッドの検証記録
